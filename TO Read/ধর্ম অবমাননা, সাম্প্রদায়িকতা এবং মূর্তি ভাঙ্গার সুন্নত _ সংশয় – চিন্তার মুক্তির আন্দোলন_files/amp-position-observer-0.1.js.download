(self.AMP=self.AMP||[]).push({n:"amp-position-observer",v:"2011252111002",f:(function(AMP,_){
'use strict';var k="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function l(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],d=0;d<b.length;++d){var c=b[d];if(c&&c.Math==Math)return}(function(){throw Error("Cannot find global object");})()}l(this);"function"===typeof Symbol&&Symbol("x");var m;
if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var r=m;var t=self.AMP_CONFIG||{},u=("string"==typeof t.cdnProxyRegex?new RegExp(t.cdnProxyRegex):t.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function v(a){if(self.document&&self.document.head&&(!self.location||!u.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}t.cdnUrl||v("runtime-host");t.geoApiUrl||v("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var w=self.__AMP_LOG;function y(){if(!w.user)throw Error("failed to call initLogConstructor");return w.user}function z(a,b,d){return y().assert(a,b,d,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)};function A(a){var b=B,d=C(a),c=D(d),f=E(c),e=f["position-observer"];e||(e=f["position-observer"]={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,adopted:!1});e.ctor||e.obj||(e.ctor=b,e.context=d,e.adopted=!1,e.resolve&&F(c,"position-observer"))}function G(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return F(a,b)}function H(a,b){var d=C(a);d=D(d);return F(d,b)}function aa(a){a=C(a);a=D(a);return I(a,"action")?F(a,"action"):null}
function C(a){return a.nodeType?G((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function D(a){a=C(a);return a.isSingleDoc()?a.win:a}function F(a,b){I(a,b);a=E(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function E(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function I(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function J(a){return a||{}};function K(a,b,d,c){return{left:a,top:b,width:d,height:c,bottom:b+c,right:a+d,x:a,y:b}}function L(a,b){return a.top<b.top?"top":a.bottom>b.bottom?"bottom":"inside"}function M(a,b){return a&&b?a.left==b.left&&a.top==b.top&&a.width==b.width&&a.height==b.height:!1};function N(a,b,d,c){this.element=b;this.R=c;this.fidelity=d;this.turn=0==d?Math.floor(4*Math.random()):0;this.C=null;this.j=H(a,"viewport")}
N.prototype.update=function(a){var b=this;if(!a){if(0!=this.turn){this.turn--;return}0==this.fidelity&&(this.turn=4)}var d=this.j.getSize(),c=K(0,0,d.width,d.height);this.j.getClientRectAsync(this.element).then(function(f){var e={positionRect:f,viewportRect:c,relativePos:null},g=b.C;if(!(g&&M(g.positionRect,e.positionRect)&&M(g.viewportRect,e.viewportRect))){g=e.positionRect;e.relativePos=L(g,e.viewportRect);var h=e.viewportRect;g.top<=h.bottom&&h.top<=g.bottom&&g.left<=h.right&&h.left<=g.right?(b.C=
e,b.R(e)):b.C&&(b.C=null,e.positionRect=null,b.R(e))}})};J({c:!0,v:!0,a:!0,ad:!0});function O(a){z(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(a),"Invalid length value: %s",a);return a};function P(a,b,d){var c={detail:d};Object.assign(c,void 0);if("function"==typeof a.CustomEvent)return new a.CustomEvent(b,c);a=a.document.createEvent("CustomEvent");a.initCustomEvent(b,!!c.bubbles,!!c.cancelable,d);return a};function ba(a,b){function d(){c=0;var g=500-(a.Date.now()-f);if(0<g)c=a.setTimeout(d,g);else{var h=e;e=null;b.apply(null,h)}}var c=0,f=0,e=null;return function(g){for(var h=[],x=0;x<arguments.length;++x)h[x-0]=arguments[x];f=a.Date.now();e=h;c||(c=a.setTimeout(d,500))}};function B(a){var b=this;this.W=a;this.V=a.win;this.h=[];this.$=G(this.V,"vsync");this.j=H(a,"viewport");this.I=[];this.L=this.N=this.M=!1;this.X=ba(this.V,function(){b.M=!1})}B.prototype.observe=function(a,b,d){var c=this,f=new N(this.W,a,b,d);this.h.push(f);this.L||ca(this);f.update();return function(){for(var e=0;e<c.h.length;e++)if(c.h[e]==f){c.h.splice(e,1);0==c.h.length&&Q(c);break}}};
B.prototype.unobserve=function(a){for(var b=0;b<this.h.length;b++)if(this.h[b].element==a){this.h.splice(b,1);0==this.h.length&&Q(this);return}if(w.dev)a=w.dev;else throw Error("failed to call initLogConstructor");a.error("POSITION_OBSERVER","cannot unobserve unobserved element")};function ca(a){a.L=!0;a.I.push(a.j.onScroll(function(){a.X();a.M=!0;a.N||R(a)}));a.I.push(a.j.onResize(function(){a.updateAllEntries(!0)}))}function Q(a){for(a.L=!1;a.I.length;)a.I.pop()()}
B.prototype.updateAllEntries=function(a){for(var b=0;b<this.h.length;b++)this.h[b].update(a)};function R(a){a.updateAllEntries();a.N=!0;a.M?a.$.measure(function(){R(a)}):a.N=!1};function S(a){a=AMP.BaseElement.call(this,a)||this;a.A=null;a.m=null;a.j=null;a.l=!1;a.H=0;a.o=0;a.O="0";a.K="0";a.D=0;a.T=0;a.J=null;a.G=null;a.B=null;a.F=0;a.S=0;a.U=!1;a.P=!1;return a}var T=AMP.BaseElement;S.prototype=k(T.prototype);S.prototype.constructor=S;if(r)r(S,T);else for(var U in T)if("prototype"!=U)if(Object.defineProperties){var V=Object.getOwnPropertyDescriptor(T,U);V&&Object.defineProperty(S,U,V)}else S[U]=T[U];S.ba=T.prototype;
S.prototype.buildCallback=function(){this.getAmpDoc().whenFirstVisible().then(this.Y.bind(this));this.U=this.element.hasAttribute("once")};S.prototype.Y=function(){var a=this;da(this);this.A=aa(this.element);this.j=H(this.element,"viewport");this.m||(A(this.getAmpDoc()),this.m=H(this.element,"position-observer"));this.getAmpDoc().whenReady().then(function(){var b=W(a);a.m.observe(b,1,a.Z.bind(a))})};
function X(a){var b=a.j.getScrollTop(),d=J({"start-scroll-offset":b,"end-scroll-offset":b+a.S,"initial-inview-percent":a.F}),c=P(a.win,"amp-position-observer.scroll",J({percent:a.F,positionObserverData:d}));a.A.trigger(a.element,"scroll",c,1)}
S.prototype.Z=function(a){if(!this.U||!this.P){var b=this.l,d=this.J&&this.J.height;this.B||(this.B=a.viewportRect.height);var c=this.B-a.viewportRect.height,f=0;150>Math.abs(c)?f=c:this.B=null;a.viewportRect=K(a.viewportRect.left,a.viewportRect.top,a.viewportRect.width,a.viewportRect.height+f);this.J=a.viewportRect;d!=a.viewportRect.height&&(this.D=Y(this,this.O),this.T=Y(this,this.K));c=a.viewportRect;c=K(c.left,c.top+this.D,c.width,c.height-this.T-this.D);f=a.positionRect;var e;if(f){var g=e=L(f,
c);if("inside"==g)this.l=!0;else{var h=f.height*("top"==g?this.H:this.o);this.l="bottom"==g?f.top<=c.bottom-h:f.bottom>=c.top+h}}else this.l=!1,e=a.relativePos;b&&!this.l&&(this.F="bottom"==e?0:1,X(this),g=P(this.win,"amp-position-observer.exit",J({})),this.A.trigger(this.element,"exit",g,1),this.P=!0);!b&&this.l&&(g=P(this.win,"amp-position-observer.enter",J({})),this.A.trigger(this.element,"enter",g,1));this.l&&(f&&(g=c.height+f.height-(f.height*this.o+f.height*this.H),c=Math.abs(f.top-this.D-(c.height-
f.height*this.o)),this.F=c/g,this.S=g-c),X(this))}};function da(a){var b=a.element.getAttribute("intersection-ratios");if(b){var d=b.trim().split(" ");a.H=Z(d[0]);a.o=a.H;d[1]&&(a.o=Z(d[1]))}var c=a.element.getAttribute("viewport-margins");c&&(c=c.trim().split(" "),a.O=c[0],a.K=a.O,c[1]&&(a.K=c[1]));a.G=a.element.getAttribute("target")}
function W(a){var b=a.G?y().assertElement(a.win.document.getElementById(a.G),"No element found with id:"+a.G):a.element.parentNode;a.win.document.body===b&&(b=a.win.document.documentElement);return b}
function Y(a,b){b="number"==typeof b?b+"px":b&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(b)?/^\d+(\.\d+)?$/.test(b)?b+"px":b:void 0;b=O(b);var d=b;O(d);d=z(/[a-z]+/i.exec(d),"Failed to read units from %s",d)[0];var c=parseFloat(b);c="number"===typeof c&&isFinite(c)?c:void 0;if(!c)return 0;z("px"==d||"vh"==d,"Only pixel or vh are valid as units for exclusion margins: "+b);"vh"==d&&(c=c/100*a.J.height);return c}
function Z(a){var b=parseFloat(a);z(0<=b&&1>=b,"Ratios must be a decimal between 0 and 1: "+a);return b}S.prototype.aa=function(){if(this.m){var a=W(this);this.m.unobserve(a);this.m=null}};(function(a){a.registerElement("amp-position-observer",S)})(self.AMP);
})});

//# sourceMappingURL=amp-position-observer-0.1.js.map
